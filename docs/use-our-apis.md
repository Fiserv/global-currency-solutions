## Constructing a RESTful API Request

FX Solutions' RESTful API allows a merchant or bank partner to test MCP or DCC in their own website, software, or terminal. Each request consists of the Header followed by the Request Body.

## Environments

FX Solutions has different environments for client development and customer testing. For ease of use, only the testing environment will be available for prospective customers. If you are not a prospective customer, please <a href="https://www.carat.fiserv.com/en-us/contact/?utm_campaign=currency_content"> contact us to get started.  

## Sandbox

https://int.api.fiservapps.com

- Uses Sandbox credentials
- Test APIs before certifying for production
- View the response format of a specific API
- Experiment, develop code and fix bugs

## API Overview

API keys are used to authenticate requests. You can request TEST API Keys from your Fiserv Sales  or FX Solutions Product team.

Please keep the TEST API Keys secure, these belong to you. Do not share your secret API Keys in publicly accessible websites. All API requests must be made over HTTPS - calls made using HTTP will fail.

## Authentication

All visitors to the Developer Studio can access the API Documentation to integrate. You'll need a TEST API Key and Secret. Contact your Fiserv Sales or FX Solutions Product team to get a TEST API Key and Secret. 

### Access FX Solution APIs

Follow the below steps to get access to begin using the FX Solutions APIs: 

1. Explore the FX Solutions Developer Studio experience.
2. Choose the product that will help you achieve your business or revenue goals and explore the corresponding APIs in the overview sections.
3. Request a TEST API Key and Secret, please contact your sales or the product point of contact.
4. You will receive a TEST API Key and Secret and Merchant ID (MID). These credentials and MID can be used for the Exchange Rate APIs used for DCC. Please note MCP can be accessed through the CommerceHub experience and details can be found on the Multi-Currency Pricing tab.
5. Use the credentials and MID for constructing the API Request to use the Exchange Rate APIs in TEST environment.
6. Validate the use case. 
7. Contact sales or the product point of contact if you need additional information. 

### Endpoints

| Environment      | Host                            | 
|------------------|---------------------------------|
| Integration Test | https://int.api.fiservapps.com |

### Request Header
FX Solutions RESTful API has a consistent header structure based on a set of parameters. To create the header, provide the following values:  

| Header Name       | Value | Description                                                                                                                   |
|-------------------|-------|-------------------------------------------------------------------------------------------------------------------------------|
| Api-Key           | Yes   | API KEY                                                                                                                       |
| Timestamp         | Yes   | Request initiation UTC timestamp, formatted as Epoch time. The value is in milliseconds. Sample value format is 1499961987232 |
| Authorization     | Yes   | HMAC {{signature}}                                                                                                            |
| Client-Request-Id | Yes   | Contains a unique ID generated by the client that is used for enforcing idempotence on POST actions.                          |
| Content-Type      | Yes   | application/json                                                                                                              |

### Generate HMAC Signature JAVA
```java

private static Mac sha256HMAC = null;
 
private String generateHmac(final String apiKey, final String clientSecret, final String time, final String clientRequestId, final String payload) throws NoSuchAlgorithmException, InvalidKeyException, JsonProcessingException {
  
    final StringBuilder rawSignature = new StringBuilder();
    rawSignature.append(apiKey);
    rawSignature.append(clientRequestId);
    rawSignature.append(time);
    rawSignature.append(payload);
    
    Mac mac = getSha256HMAC();
    SecretKeySpec secretKeySpec = new SecretKeySpec(clientSecret.getBytes(), "HmacSHA256");
    mac.init(secretKeySpec);
  
    byte[] finalHmac = mac.doFinal(rawSignature.toString().getBytes());
  
    return Base64.encodeBase64String(finalHmac);
}
  
private static Mac getSha256HMAC() throws NoSuchAlgorithmException {
    if (sha256HMAC == null) {
        sha256HMAC = Mac.getInstance("HmacSHA256");
    }
  
    return sha256HMAC;
}
```
### Postman HMAC
```javascript
var key = postman.getEnvironmentVariable('clientId');
var secret = postman.getEnvironmentVariable('clientSecret');
 
var time = new Date().getTime();
var method = request.method;
var ClientRequestId = Math.floor((Math.random() * 10000000) + 1);
var requestBody = request.data;
 
var rawSignature = key + ClientRequestId + time + requestBody;
var computedHash = CryptoJS.algo.HMAC.create(CryptoJS.algo.SHA256, secret.toString());
computedHash.update(rawSignature);
computedHash = computedHash.finalize();
 
var computedHmac = CryptoJS.enc.Base64.stringify(computedHash);
 
postman.setEnvironmentVariable('ClientRequestId', ClientRequestId);
postman.setEnvironmentVariable('time', time);
postman.setEnvironmentVariable('signature', computedHmac);
postman.setEnvironmentVariable('key', key);
```
## HTTP Error Codes

FX Solutions products use conventional response codes to indicate the success or failure of an API request. At a high-level, 200 code indicates success, 4xx codes indicate an error that failed given the information provided, and 5xx codes indicate an error with servers.

Accompanying the 4xx codes will be messages with detail on the parameter causing the error.

### OpenFX Error Messages/Codes

| HTTP Status                | 	Response Code           | 	Reason	                                                                 | Message                                                                                           |
|----------------------------|--------------------------|--------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------|
| OK[Eligible = Y]	          | 200	                     | RateSupplied                                                             |                                                                                                   |
| OK[Eligible = D]	          | 200	                     | SourceAndTargetCannotBeSame                                              |                                                                                                   |
| OK[Eligible = N]	          | 200	                     | CardBrandNotSupported                                                    |                                                                                                   |
| BAD_REQUEST	               | 400	                     | NoLocationInfo	                                                          | Invalid client: {CLIENT_ID}_{LOCATION_ID}                                                         |
| BAD_REQUEST	               | 400	                     | TargetCurrencyInExclusion	                                               | Target currency not permitted for client                                                          |                                                      
| BAD_REQUEST	               | 400                      | 	TargetCurrencyNotSupported  InvalidSourceAmount                         |                                                                                                   |
| NOT_FOUND	                 | 404	                     | SourceCurrencyInExclusion  SourceCurrencyNotSupported  NoRatesAvailable	 | No rate available                                                                                 |                                
| NOT_FOUND	                 | 404	                     | NoSourceCurrencySpecified	                                               | Field error: rateRequest.source Field is limited to the 3 character ISO-4217 alpha currency code. |
| NOT_FOUND	                 | 404	                     | NoBinInfoAvailable  BinNotSupported                                      | 	BIN or closest match not found: <BIN>                                                            |
| NOT_FOUND	                 | 404	                     | CountryNotSupported  NoPricingTypeSpecified  PricingTypeNotSupported     |                                                                                                   |
| INTERNAL_SERVER_ERROR	     | 504                      | 	Timeout                                                                 |                                                                                                   |
| INTERNAL_SERVER_ERROR	500	 | Unhandled Exception    	 |                                                                          |                                                                                                   |

