## Constructing a RESTful API Request
FX Solutions RESTful API allows a merchant or bank partner to get FX Rates used for MCP or DCC within their own website, software, or terminal. Each request consists of the Header followed by the Request Body.

## Environments

FX Solutions has different environments, that allow the consumption of our RESTful APIs for client development and customer testing. For ease of use, only the testing environment will be available.

## Sandbox
<https://int.api.fiservapps.com>

- Uses Sandbox credentials
- Test APIs before certifying for production
- View the response format of a specific API
- Experiment, develop code and fix bugs

## API Overview
The FX Solutions APIs use API keys to authenticate requests. You can request your TEST API keys by creating a user account on Developer Studio.

Please keep the TEST API keys secure, these belong to you. Do not share your secret API keys in publicly accessible websites such as GitHub, client-side code, and so forth. All API requests must be made over HTTPS. Calls made using HTTP will fail.

## Authentication
All visitors to the Developer Studio can access the API Documentation to integrate you'll need a TEST API key and secret. You'll need to register for an account to get an API key and secret.

### Access FX Solution APIs

Follow the below steps to get access to the Developer Studio and use the FX Solutions APIs.

1. Create a developer account in the Developer Studio. To create an account, you will need a valid business email address.

1. Request a TEST API Key and Secret. After account creation,  you will receive access to a shared sandbox Merchant ID (MID) and FX Solutions Exchange Rate APIs. You will also receive a test API Key and Secret via encrypted email. This API Key and Secret will be used for authentication.

1. Construct an API Request to use the Exchange Rate APIs in TEST environment. For DCC, use 1) GET RATE  and 2)GET BINS BY CURRENCY. For MCP, use  GET ALL RATES. 

### Endpoints

| Environment      | Host                            | 
|------------------|---------------------------------|
| Integration Test | <https://int.api.firstdata.com> |

### Request Header
FX Solutions RESTful API has a consistent header structure based on a set of parameters. To create the header, provide the following values:

| Header Name       | Value | Description                                                                                                                   |
|-------------------|-------|-------------------------------------------------------------------------------------------------------------------------------|
| Api-Key           | Yes   | API KEY                                                                                                                       |
| Timestamp         | Yes   | Request initiation UTC timestamp, formatted as Epoch time. The value is in milliseconds. Sample value format is 1499961987232 |
| Authorization     | Yes   | HMAC {{signature}}                                                                                                            |
| Client-Request-Id | Yes   | Contains a unique ID generated by the client that is used for enforcing idempotence on POST actions.                          |
| Content-Type      | Yes   | application/json                                                                                                              |

### Generate HMAC Signature JAVA
```java

private static Mac sha256HMAC = null;
 
private String generateHmac(final String apiKey, final String clientSecret, final String time, final String clientRequestId, final String payload) throws NoSuchAlgorithmException, InvalidKeyException, JsonProcessingException {
  
    final StringBuilder rawSignature = new StringBuilder();
    rawSignature.append(apiKey);
    rawSignature.append(clientRequestId);
    rawSignature.append(time);
    rawSignature.append(payload);
    
    Mac mac = getSha256HMAC();
    SecretKeySpec secretKeySpec = new SecretKeySpec(clientSecret.getBytes(), "HmacSHA256");
    mac.init(secretKeySpec);
  
    byte[] finalHmac = mac.doFinal(rawSignature.toString().getBytes());
  
    return Base64.encodeBase64String(finalHmac);
}
  
private static Mac getSha256HMAC() throws NoSuchAlgorithmException {
    if (sha256HMAC == null) {
        sha256HMAC = Mac.getInstance("HmacSHA256");
    }
  
    return sha256HMAC;
}
```
### Postman HMAC
```javascript
var key = postman.getEnvironmentVariable('clientId');
var secret = postman.getEnvironmentVariable('clientSecret');
 
var time = new Date().getTime();
var method = request.method;
var ClientRequestId = Math.floor((Math.random() * 10000000) + 1);
var requestBody = request.data;
 
var rawSignature = key + ClientRequestId + time + requestBody;
var computedHash = CryptoJS.algo.HMAC.create(CryptoJS.algo.SHA256, secret.toString());
computedHash.update(rawSignature);
computedHash = computedHash.finalize();
 
var computedHmac = CryptoJS.enc.Base64.stringify(computedHash);
 
postman.setEnvironmentVariable('ClientRequestId', ClientRequestId);
postman.setEnvironmentVariable('time', time);
postman.setEnvironmentVariable('signature', computedHmac);
postman.setEnvironmentVariable('key', key);
```
## HTTP Error Codes

FX Solutions products use conventional HTTP response codes to indicate the success or failure of an API request. At a high-level, 200 code indicates success, 4xx codes indicate an error that failed given the information provided, 5xx codes indicate an error with servers.

Accompanying the 4xx codes will be messages with detail on the parameter causing the error.

#### OpenFX Error Messages/Codes

| HTTP Status                | 	Response Code           | 	Reason	                                                                 | Message                                                                                           |
|----------------------------|--------------------------|--------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------|
| OK[Eligible = Y]	          | 200	                     | RateSupplied                                                             |                                                                                                   |
| OK[Eligible = D]	          | 200	                     | SourceAndTargetCannotBeSame                                              |                                                                                                   |
| OK[Eligible = N]	          | 200	                     | CardBrandNotSupported                                                    |                                                                                                   |
| BAD_REQUEST	               | 400	                     | NoLocationInfo	                                                          | Invalid client: {CLIENT_ID}_{LOCATION_ID}                                                         |
| BAD_REQUEST	               | 400	                     | TargetCurrencyInExclusion	                                               | Target currency not permitted for client                                                          |                                                      
| BAD_REQUEST	               | 400                      | 	TargetCurrencyNotSupported  InvalidSourceAmount                         |                                                                                                   |
| NOT_FOUND	                 | 404	                     | SourceCurrencyInExclusion  SourceCurrencyNotSupported  NoRatesAvailable	 | No rate available                                                                                 |                                
| NOT_FOUND	                 | 404	                     | NoSourceCurrencySpecified	                                               | Field error: rateRequest.source Field is limited to the 3 character ISO-4217 alpha currency code. |
| NOT_FOUND	                 | 404	                     | NoBinInfoAvailable  BinNotSupported                                      | 	BIN or closest match not found: <BIN>                                                            |
| NOT_FOUND	                 | 404	                     | CountryNotSupported  NoPricingTypeSpecified  PricingTypeNotSupported     |                                                                                                   |
| INTERNAL_SERVER_ERROR	     | 504                      | 	Timeout                                                                 |                                                                                                   |
| INTERNAL_SERVER_ERROR	500	 | Unhandled Exception    	 |                                                                          |                                                                                                   |

